<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WalletConnect Button</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script type="module">
    import { EthereumProvider } from "https://esm.sh/@walletconnect/ethereum-provider@2.11.1";
    import QRCodeModal from "https://esm.sh/@walletconnect/qrcode-modal";

    const projectId = "685604db11bce85e357332363ed2a81f"; // ✅ Your WalletConnect Project ID

    async function connectWallet() {
      try {
        // Initialize WalletConnect provider
        const provider = await EthereumProvider.init({
          projectId,
          chains: [1], // Ethereum Mainnet; add other chain IDs if needed
          showQrModal: false, // We’ll show our own modal via QRCodeModal
          rpcMap: {
            1: "https://rpc.ankr.com/eth" // Free public RPC endpoint
          },
          metadata: {
            name: "Demo DApp",
            description: "WalletConnect Integration Example",
            url: "https://example.org",
            icons: ["https://walletconnect.com/walletconnect-logo.png"]
          }
        });

        // Show QR modal when WC gives us a URI
        provider.on("display_uri", (uri) => {
          QRCodeModal.open(uri, () => {
            console.log("QR Modal closed");
          });
        });

        // Connect wallet
        await provider.connect();
        QRCodeModal.close();

        // Wrap with ethers.js for easier usage
        const web3Provider = new ethers.providers.Web3Provider(provider);
        const signer = web3Provider.getSigner();
        const address = await signer.getAddress();

        alert("✅ Connected: " + address);
        console.log("Connected Address:", address);

        // (Optional) handle disconnect
        provider.on("disconnect", () => {
          alert("❌ Wallet disconnected");
        });

      } catch (err) {
        console.error("❌ WalletConnect Error:", err);
        alert("Connection failed. Check console for details.");
      }
    }

    // Attach button click
    window.addEventListener("DOMContentLoaded", () => {
      document.getElementById("connectBtn").addEventListener("click", connectWallet);
    });
  </script>
</head>
<body style="display:flex;justify-content:center;align-items:center;height:100vh;background:#f0f2f5;">
  <button id="connectBtn" style="padding:15px 25px;font-size:18px;border:none;border-radius:8px;background:#3b82f6;color:#fff;cursor:pointer;">
    Connect with WalletConnect
  </button>
</body>
</html>
