<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WalletConnect Web3Modal Demo</title>
</head>
<body>
  <div style="padding: 20px; font-family: Arial, sans-serif;">
    <h1>WalletConnect Demo</h1>
    <button id="connectBtn" style="padding: 12px 24px; background: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
      Connect Wallet
    </button>
    <div id="status" style="margin-top: 20px; padding: 10px; background: #f5f5f5; border-radius: 4px;">
      Status: Loading...
    </div>
    <div id="account" style="margin-top: 10px; padding: 10px; background: #e8f5e8; border-radius: 4px; display: none;">
      <strong>Connected Account:</strong>
      <div id="accountAddress"></div>
    </div>
  </div>

  <!-- ✅ Correct UMD bundles -->
  <script src="https://unpkg.com/@web3modal/html@4.2.3/dist/index.umd.js"></script>
  <script src="https://unpkg.com/@web3modal/ethers@4.2.3/dist/index.umd.js"></script>

  <script>
    const statusDiv = document.getElementById('status');
    const connectBtn = document.getElementById('connectBtn');
    const accountDiv = document.getElementById('account');
    const accountAddressDiv = document.getElementById('accountAddress');

    const projectId = "685604db11bce85e357332363ed2a81f"; // ✅ your project id

    // Chains
    const chains = [
      {
        chainId: 1,
        name: "Ethereum",
        currency: "ETH",
        explorerUrl: "https://etherscan.io",
        rpcUrl: "https://cloudflare-eth.com"
      }
    ];

    // Metadata
    const metadata = {
      name: "My Wallet App",
      description: "My Wallet App Description",
      url: window.location.origin,
      icons: ["https://avatars.githubusercontent.com/u/37784886"]
    };

    // ✅ Initialize modal
    const modal = new window.Web3Modal.Web3Modal({
      projectId,
      chains,
      ethersConfig: window.Web3Modal.defaultConfig({ metadata }),
      enableAnalytics: false
    });

    // Subscribe to provider changes
    modal.subscribeProvider(({ address, isConnected }) => {
      if (isConnected && address) {
        statusDiv.textContent = "Connected successfully!";
        accountAddressDiv.textContent = address;
        accountDiv.style.display = "block";
        connectBtn.textContent = "Disconnect";
      } else {
        statusDiv.textContent = "Ready to connect";
        accountDiv.style.display = "none";
        connectBtn.textContent = "Connect Wallet";
      }
    });

    // Button click
    connectBtn.addEventListener("click", async () => {
      try {
        if (connectBtn.textContent === "Disconnect") {
          await modal.disconnect();
        } else {
          statusDiv.textContent = "Opening WalletConnect modal...";
          await modal.open();
        }
      } catch (err) {
        console.error(err);
        statusDiv.textContent = "Error: " + err.message;
      }
    });

    statusDiv.textContent = "Ready to connect";
  </script>
</body>
</html>
